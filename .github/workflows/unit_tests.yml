---
name: Unit Tests

on:  # yamllint disable-line rule:truthy
  push: {}
  pull_request: {}

jobs:
  # Purpose: Executes fast unit tests across multiple Python versions to
  #          ensure compatibility
  # What it does: Runs pytest unit test suite in matrix strategy for Python
  #               3.9, 3.11, 3.12, 3.13
  # Problems it solves: Validates code functionality without external
  #                     dependencies, ensures cross-version compatibility,
  #                     provides quick feedback on code changes, catches
  #                     regressions early in development
  unit-tests:
    runs-on: [self-hosted, linux, x64]
    strategy:
      matrix:
        # skip 3.10 bcs issue with it, don't know how fix
        python-version: [3.9, 3.11, 3.12, 3.13]
    steps:
      - uses: actions/checkout@v5
      - uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
      - name: Show Python version from matrix
        run: echo "${{ matrix.python-version }}"
      - name: Install uv
        run: pip install uv
      - name: Install dependencies
        run: uv sync --dev
      - name: Run unit tests
        run: |
          PYTHONPATH=$PWD uv run pytest tests/test_unit -svl \
            --log-cli-level INFO --tb=short --setup-show

# Local run:
# - Install uv:
#   pip install uv
# - Install dependencies:
#   uv sync --dev
# - Run all unit tests:
#   PYTHONPATH=$PWD uv run pytest tests/test_unit -svl
# - Run specific test file:
#   PYTHONPATH=$PWD uv run pytest tests/test_unit/test_specific.py -svl
# - Run with coverage:
#   PYTHONPATH=$PWD uv run pytest tests/test_unit --cov=shadowstep
